graph TB
    subgraph "User Interface Layer"
        UI["Streamlit Web Interface<br/>ğŸ“± Chat Frontend<br/>ğŸ“¤ Document Upload"]
        Admin["Admin Interface<br/>âš™ï¸ Configuration<br/>ğŸ—‘ï¸ Collection Management"]
    end
    
    subgraph "Application Layer - Current"
        UploadHandler["Document Upload Handler<br/>ğŸ“„ Multi-format Support"]
        SearchHandler["Search Handler<br/>ğŸ” Query Processing"]
        AuthHandler["Authentication Handler<br/>ğŸ” SharePoint SSO/OAuth2"]
    end
    
    subgraph "Processing Layer - Current"
        Parser["Document Parser<br/>PDF, Word, PPT, TXT"]
        Chunker["Text Chunker<br/>Size: 500, Overlap: 100"]
        Embedder["Sentence Transformer<br/>all-MiniLM-L6-v2"]
    end
    
    subgraph "AI/LLM Layer - Current"
        LLM["Groq LLM<br/>gpt-oss-20b<br/>Answer Generation"]
    end
    
    subgraph "Data Storage Layer - Current"
        VectorDB[("Qdrant Vector Store<br/>ğŸ“Š Embeddings & Chunks")]
    end
    
    subgraph "External Services - Current"
        SharePoint["SharePoint Online<br/>ğŸ”— Document Source"]
        GroqAPI["Groq API<br/>ğŸ¤– LLM Service"]
    end
    
    subgraph "Future Components - Planned"
        PlannerAgent["Planner Agent<br/>ğŸ¯ Orchestrator<br/>Route queries"]
        DisambiguationAgent["Disambiguation Agent<br/>â“ Intent Clarification"]
        RAGAgent["RAG Agent<br/>ğŸ“š Retrieval Specialist"]
        SQLAgent["SQL Query Generator Agent<br/>ğŸ’¾ Database Queries"]
        ResponseCompiler["Response Compiler Agent<br/>âœï¸ Response Synthesis"]
        Langfuse["Langfuse<br/>ğŸ“ Prompt Management<br/>& Versioning"]
        SQLExecutor["SQL Query Executor<br/>ğŸ—„ï¸ Database Access"]
        StructuredDB[("Structured Database<br/>ğŸ“‹ Metadata & Relations")]
        MultiModalParser["Multi-modal Parser<br/>ğŸ–¼ï¸ Images, Tables, Charts"]
        AdvancedChunker["Advanced Chunker<br/>ğŸ§  Semantic Chunking"]
    end
    
    %% User Interactions
    UI -->|"/chat"| SearchHandler
    UI -->|"/upload"| UploadHandler
    Admin -->|"/config"| UploadHandler
    
    %% Current Flow - Upload
    UploadHandler -->|"File/URL"| AuthHandler
    AuthHandler -->|"Authenticated"| SharePoint
    AuthHandler -->|"Download"| Parser
    Parser -->|"Extracted Text"| Chunker
    Chunker -->|"Text Chunks"| Embedder
    Embedder -->|"Vectors"| VectorDB
    
    %% Current Flow - Search
    SearchHandler -->|"Query"| Embedder
    Embedder -->|"Query Vector"| VectorDB
    VectorDB -->|"Similar Chunks"| SearchHandler
    SearchHandler -->|"Context + Query"| LLM
    LLM -->|"Answer"| UI
    
    %% Future Flow - Agentic Architecture
    UI -.->|"Future"| PlannerAgent
    PlannerAgent -.->|"Route"| DisambiguationAgent
    PlannerAgent -.->|"Route"| RAGAgent
    PlannerAgent -.->|"Route"| SQLAgent
    DisambiguationAgent -.->|"Clarified"| RAGAgent
    DisambiguationAgent -.->|"Clarified"| SQLAgent
    DisambiguationAgent -.->|"Clarified"| ResponseCompiler
    RAGAgent -.->|"Retrieved"| VectorDB
    RAGAgent -.->|"Results"| ResponseCompiler
    SQLAgent -.->|"Query"| SQLExecutor
    SQLExecutor -.->|"Results"| StructuredDB
    SQLAgent -.->|"Results"| ResponseCompiler
    ResponseCompiler -.->|"Final Answer"| UI
    
    %% Future Enhancements
    UploadHandler -.->|"Future"| MultiModalParser
    MultiModalParser -.->|"Enhanced"| AdvancedChunker
    AdvancedChunker -.->|"Better Chunks"| Embedder
    
    %% Prompt Management
    PlannerAgent -.->|"Prompts"| Langfuse
    DisambiguationAgent -.->|"Prompts"| Langfuse
    RAGAgent -.->|"Prompts"| Langfuse
    SQLAgent -.->|"Prompts"| Langfuse
    ResponseCompiler -.->|"Prompts"| Langfuse
    
    %% Styling
    classDef current fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef future fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef storage fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    classDef external fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class UI,Admin,UploadHandler,SearchHandler,AuthHandler,Parser,Chunker,Embedder,LLM current
    class PlannerAgent,DisambiguationAgent,RAGAgent,SQLAgent,ResponseCompiler,Langfuse,SQLExecutor,MultiModalParser,AdvancedChunker future
    class VectorDB,StructuredDB storage
    class SharePoint,GroqAPI external

